<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <script src="http://openlayers.org/api/OpenLayers.js"></script>
     <script src="scripts/jQuery.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <script type="text/javascript">
        function init() {


            //Center of map
            var lat = 0;
            var lon = 0;
            var lonlat = new OpenLayers.LonLat(lon, lat);
            var map = new OpenLayers.Map("basicMap");
            // Create overlays
            //  OSM
            var mapnik = new OpenLayers.Layer.OSM();
            var layer_cloud = new OpenLayers.Layer.XYZ(
                "temperature",
                "http://${s}.tile.openweathermap.org/map/wind/${z}/${x}/${y}.png", {
                    isBaseLayer: false,
                    opacity: 0.2,
                    sphericalMercator: true

                }
            );

            var layer_precipitation = new OpenLayers.Layer.XYZ(
                "wind",
                "http://${s}.tile.openweathermap.org/map/wind/${z}/${x}/${y}.png", {
                    isBaseLayer: false,
                    opacity: 0.4,
                    sphericalMercator: true
                }
            );


            map.addLayers([mapnik, layer_precipitation, layer_cloud]);
            map.setCenter(lonlat, 3);

            map.events.register('click', map, handleMapClick);

            function handleMapClick(e)
            {
                var lonlat = map.getLonLatFromViewPortPx(e.xy);
                lonlat.transform( map.projection,map.displayProjection);

                var Longitude = String(lonlat.lon);
                var Latitude  = String(lonlat.lat);
                Longitude=Longitude.split('.')[0];
                Latitude=Latitude.split('.')[0];
                Longitude=Longitude.substring(0,Longitude.length-2);
                Latitude=Latitude.substring(0,Latitude.length-2);
                Longitude=parseInt(Longitude)/1000*0.9;
                Latitude=parseInt(Latitude)/1000*0.782;//perfect
                var html="Longitude: "+Longitude+"<br/> Latitude: "+Latitude+"<br/>";
                $("#position").html(html);

                $.get('http://api.openweathermap.org/data/2.5/weather?lat='+Latitude+'&lon='+Longitude+'&mode=html', function(test){ 
                    $("#position").html(test);
                    /*var weather=test["main"];
                    html+="Temp: "+parseInt(weather["temp"]-273.15)+" Humidity: "+weather["humidity"]+" Pressure: "+weather["pressure"]+"<br/>"
                    html+="Country: "+test["sys"]["country"]+" City:"+test["name"]+"<br/>";
                    html+="Wind speed: "+parseInt(test["wind"]["speed"])*1.609344+"km/h Angle: "+test["wind"]["deg"]+" deg<br/>";
                    $("#position").html(html);*/
                });
                /*$.getJSON('http://api.openweathermap.org/data/2.5/find?lat='+Latitude+'&lon='+Longitude+'&cnt=10', function(test){ 
                    console.log(test);
                    $("#position").html(test);
                });*/
            } 


        }
    </script>

</head>

<body onload="init()">
    <div id="basicMap"></div>
    <div id="UI">
        <div id="position">Info:</div>
         <div id="adress">
                <form id="search">
                    <input type="text" placeholder="Entrez votre ville" id="searchvalue">
                </form>
                <div id="searchResults"></div>
            </div>
        <div id="logotitle">EolAtlas</div>
    </div>
</body>

</html>